# Use the latest version of Alpine
FROM alpine:latest

# Update apk repositories
RUN apk update

# Install necessary packages
RUN apk add --no-cache \
    xvfb \
    xrdp \
    xfce4 \
    xfce4-terminal \
    xorg-server \
    dbus \
    udev \
    ttf-freefont \
    supervisor

# Configure xrdp
RUN adduser -D -s /bin/sh alpine
RUN echo "alpine:alpine" | chpasswd
RUN sed -i 's/allowed_users=console/allowed_users=anybody/' /etc/X11/Xwrapper.config

# Add Supervisor configuration file to manage xrdp and xfce4-session
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# Expose the RDP port
EXPOSE 3389

# Start Supervisor on container start
CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
